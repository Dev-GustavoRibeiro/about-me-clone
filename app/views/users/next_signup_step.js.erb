<% if @step == '2' %>
  let email, firstName, lastName, userLocation, userReason;
  let userInterests = [], userOccupations = [];
  prepareSignupStepTwo();
<% elsif @step == '3' %>
  prepareSignupStepThree();
<% elsif @step == '4' %>
  prepareSignupStepFour();
<% elsif @step == '5' %>
  prepareSignupStepFive();
<% elsif @step == '6' %>
  prepareSignupStepSix();
<% elsif @step == '7' %>
  prepareSignupStepSeven();
<% end %>

function prepareSignupStepTwo() {
  updateNavbar();
  email = $('#email').val();
  $('.signup-form-area').detach();
  $('.main-signup').append('<%= j (render 'signup_step_two') %>');
  addHiddenInputForAllFilledItems();
}

function updateNavbar() {
  $('.navbar-nav').detach();
  $('.navbar-brand').css('color', 'white');
  $('.navbar-signup').css('background-color', '#0a84d0');
}

function addHiddenInputForAllFilledItems() {
  if (email !== undefined) addHiddenInput('email', email);
  if (firstName !== undefined) addHiddenInput('first_name', firstName);
  if (lastName !== undefined) addHiddenInput('last_name', lastName);
  if (userLocation !== undefined) addHiddenInput('user_location', userLocation);
  if (userInterests.length > 0) addHiddenInput('user_interests', userInterests);
  if (userOccupations.length > 0) addHiddenInput('user_occupations', userOccupations);
  if (userReason !== undefined) addHiddenInput('user_reason', userReason);
}

function addHiddenInput(name, value) {
  $('form').append(`<input type="hidden" id=${name} name=${name} value=${value}>`);
}

function prepareSignupStepThree() {
  firstName = $('#first_name').val();
  lastName = $('#last_name').val();
  $('.signup-form-area').detach();
  $('.main-signup').append('<%= j (render 'signup_step_three') %>');
  $('.step-description').text(`Where are you, ${firstName}?`);
  addHiddenInputForAllFilledItems();
}

function prepareSignupStepFour() {
  userLocation = $('#user_location').val();
  $('.signup-form-area').detach();
  $('.main-signup').append('<%= j (render 'signup_step_four') %>');
  addHiddenInputForAllFilledItems();
  $('li[item-to-select]').click(function() { selectToggle(this); });
  $('.selected-item').click(function() { 
    deselectElement(this); 
    submitButtonToggle();
  });
}

function selectToggle(element, maxNumberOfBlankFields = 2) {
  if (userHasAlreadySelectedTheItems() && !thisElementIsAlreadySelected(element))
    return;
  else if (thisElementIsAlreadySelected(element))
    deselectElement(element);
  else
    selectElement(element);
  submitButtonToggle(maxNumberOfBlankFields);
}

function userHasAlreadySelectedTheItems() {
  return $('.selected-item:empty').length === 0;
}

function thisElementIsAlreadySelected(element) {
  return $(`.selected-item:contains(${$(element).text()})`).length === 1;
}

function deselectElement(element) {
  const selectedItem = $(element).text();
  if (selectedItem === '') return;
  $(`li[item-to-select]:contains(${selectedItem})`).css('color', '#0a84d0')
                                                   .css('background-color', 'white');
  $(`.selected-item:contains(${selectedItem})`).text('')
                                               .val(0)
                                               .css('background-color', 'white');
}

function selectElement(element) {
  $(element).css('color', 'white').css('background-color', '#0a84d0');
  $('.selected-item:empty').first().text($(element).text())
                           .val($(element).val())
                           .css('background-color', '#0a84d0');
}

function submitButtonToggle(maxNumberOfBlankFields = 2) {
  if ($('.selected-item:empty').length <= maxNumberOfBlankFields) 
    $('.next-step-button').prop('disabled', false);
  else
    $('.next-step-button').prop('disabled', true);
}

function prepareSignupStepFive() {
  $('.selected-item').each((index, item) => {
    const value = $(item).val();
    if (value !== 0) userInterests.push(value);
  });
  $('.signup-form-area').detach();
  $('.main-signup').append('<%= j (render 'signup_step_five') %>');
  addHiddenInputForAllFilledItems();
  $('li[item-to-select]').click(function() { selectToggle(this); });
  $('.selected-item').click(function() { 
    deselectElement(this); 
    submitButtonToggle();
  });
}

function prepareSignupStepSix() {
  $('.selected-item').each((index, item) => {
    const value = $(item).val();
    if (value !== 0) userOccupations.push(value);
  });
  $('.signup-form-area').detach();
  $('.main-signup').append('<%= j (render 'signup_step_six') %>');
  addHiddenInputForAllFilledItems();
  $('li[item-to-select]').click(function() { 
    addReasonInput(this);
    selectToggle(this, 0);
  });
  $('.selected-item').click(function() {
    $("input[name='reason']").detach();
    deselectElement(this); 
    submitButtonToggle(0);
  });
}

function addReasonInput(reason) {
  if (!userHasAlreadySelectedTheItems()) {
    $("input[name='reason']").detach();
    addHiddenInput('reason', $(reason).val())
  }
}
<%# ------------------------------- REFACTOR THIS FILE -------------------------------- %>

function prepareSignupStepSeven() {
  userReason = $('.selected-item').val();
  $('.signup-form-area').detach();
  $('.main-signup').append('<%= j (render 'signup_step_seven') %>');
  addHiddenInputForAllFilledItems();
}
